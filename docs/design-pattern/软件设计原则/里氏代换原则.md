

里氏代换原则是面向对象设计的基本原则之一。

里氏代换原则：任何基类可以出现的地方，子类一定可以出现。通俗理解：子类可以扩展父类的功能，但不能改变父类原有的功能。换句话说，**子类继承父类时，除添加新的方法完成新增功能外，尽量不要重写父类的方法**。

如果通过重写父类的方法来完成新的功能，这样写起来虽然简单，但是整个继承体系的可复用性会比较差，特别是运用多态比较频繁时，程序运行出错的概率会非常大。

例如：正方形不是长方形：在数学领域里，正方形毫无疑问是长方形，它是一个长宽相等的长方形。开发一个与几何图形相关的软件系统，可以让正方形继承自长方形。


```java
/**
 * 长方形类
 */
public class Rectangle {

   private double length;
   private double width;

   public double getLength() {
       return length;
   }

   public void setLength(double length) {
       this.length = length;
   }

   public double getWidth() {
       return width;
   }

   public void setWidth(double width) {
       this.width = width;
   }
}
```


```java
/**
 * 正方形类
 */
public class Square extends Rectangle {
   @Override
   public void setLength(double length) {
       super.setLength(length);
       super.setWidth(length);
   }

   @Override
   public void setWidth(double width) {
        super.setWidth(width);
        super.setLength(width);
   }
}
```


```java
public class RectangleDemo {
    public static void main(String[] args) {
        // 创建长方形对象，并设置长和宽
        Rectangle r = new Rectangle();
        r.setLength(20);
        r.setWidth(10);
        // 扩宽并打印输出
        resize(r);
        printRectangle(r);

        System.out.println("--------------------");
        // 创建正方形对象，并设置长和宽
        Square s = new Square();
        s.setLength(10);
        // 扩宽并打印输出
        resize(s);    // 进入死循环
        printRectangle(s);
    }

    // 扩宽方法
    public static void resize(Rectangle rectangle) {
        // 如果宽比长小，则扩宽
        while (rectangle.getWidth() <= rectangle.getLength()) {
            rectangle.setWidth(rectangle.getWidth() + 1);
        }
    }

    // 打印方法
    public static void printRectangle(Rectangle rectangle) {
        System.out.println("length = " + rectangle.getLength());
        System.out.println("width = " + rectangle.getWidth());
    }
}

```


假如把一个普通长方形作为参数传入resize方法，就会看到长方形宽度逐渐增长的效果，当宽度大于长度，代码就会停止，这种行为的结果符合预期；假如再把一个正方形作为参数传入resize方法后，就会看到正方形的宽度和长度都在不断增长，代码会一直运行下去，直至系统产生溢出错误。所以，普通的长方形是适合这段代码的，正方形不适合。

在resize方法中，Rectangle类型的参数是不能被Square类型的参数所代替，如果进行了替换就得不到预期结果。因此，Square类和Rectangle类之间的继承关系违反了里氏代换原则，它们之间的继承关系不成立，正方形不是长方形。

需要重新设计他们之间的关系。抽象出来一个四边形接口(Quadrilateral)，让Rectangle类和Square类实现Quadrilateral接口。

![](assets/%E9%87%8C%E6%B0%8F%E4%BB%A3%E6%8D%A2%E5%8E%9F%E5%88%99/4b4c935fbce6c252ea7fff18768e81c1_MD5.png)

改进之后：

```java
/**
 * 四边形接口
 */
public interface Quadrilateral {
    double getLength();
    double getWidth();
}
```


```java
/**
 * 长方形类
 */
public class Rectangle implements Quadrilateral {

    private double length;
    private double width;

    @Override
    public double getLength() {
        return length;
    }
    public void setLength(double length) {
        this.length = length;
    }

    @Override
    public double getWidth() {
        return width;
    }
    public void setWidth(double width) {
        this.width = width;
    }
}
```


```java
/**
 * 正方形类
 */
public class Square implements Quadrilateral {

    private double side;
    public void setSide(double side) {
        this.side = side;
    }

    @Override
    public double getLength() {
        return side;
    }
    @Override
    public double getWidth() {
        return side;
    }
}
```


```java
public class RectangleDemo {
    public static void main(String[] args) {
        // 创建长方形对象，并设置长和宽
        Rectangle r = new Rectangle();
        r.setLength(20);
        r.setWidth(10);
        // 扩宽并打印输出
        resize(r);
        printQuadrilateral(r);

        System.out.println("--------------------");
        // 创建正方形对象，并设置长和宽
        Square s = new Square();
        s.setSide(10);
        // 打印输出，正方形就无法扩宽了
        printQuadrilateral(s);
    }

    // 扩宽方法
    public static void resize(Rectangle rectangle) {
        // 如果宽比长小，则扩宽
        while (rectangle.getWidth() <= rectangle.getLength()) {
            rectangle.setWidth(rectangle.getWidth() + 1);
        }
    }

    // 打印方法
    public static void printQuadrilateral(Quadrilateral quadrilateral) {
        System.out.println("length = " + quadrilateral.getLength());
        System.out.println("width = " + quadrilateral.getWidth());
    }
}
```